name: "My practice CI/CD Pipeline"

on:
    push:
        branches: [main, master]
    pull_request:
        branches: [main, master]
    workflow_dispatch:

jobs:
    test:
        name: Run test
        runs-on: "ubuntu-latest"

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                node-version: '18'

            - name: Run tests
              run: |
                echo Running our awesome tests....
                node test.js
                echo All tests has completed successfully

            - name: Check linting
              run: |
                echo Check for linting errors
                npm run lint
                echo Code looks great

    deploy:
        name: Deploy to Production
        runs-on: ubuntu-latest
        needs: test
        if: github.event_name == 'push' && (github.ref == 'refs/branch/main' || github.ref == 'refs/branch/master')

        steps:
            - name: Checkout Code
              uses: actions/checkout@v4

            - name: Deploy to Github Pages
              uses: peaceiris/actions-gh-pages@v3
              with:
                github_token: ${{secrets.GITHUB_TOKEN}}
                publish_dir: ./
                commit_message: 'ğŸš€ Deploy: ${{ github.event.head_commit.message }}'

            - name: ğŸ‰ Deployment Success
              run: |
                 echo "ğŸ‰ Your app is now live!"
                 echo "ğŸŒ Visit: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
                 echo "â­ Great job on your first CI/CD pipeline!"

    notify:
        name: Send Notification
        runs-on: ubuntu-latest
        needs: [test, deploy]
        if: always()

        steps:
            - name: Report status
              run: |
                if [[ "${{ needs.test.result }}" == "success" && "${{ needs.deploy.result }}" == "success" ]]; then
                  echo "âœ… PIPELINE SUCCESS!"
                  echo "ğŸ§ª Tests: PASSED"
                  echo "ğŸš€ Deployment: SUCCESS"
                  echo "ğŸŒ Your app is live and ready!"
                elif [[ "${{ needs.test.result }}" == "failure" ]]; then
                  echo "âŒ PIPELINE FAILED!"
                  echo "ğŸ§ª Tests: FAILED"
                  echo "ğŸ”§ Please check your code and fix the failing tests"
                elif [[ "${{ needs.deploy.result }}" == "failure" ]]; then
                  echo "âš ï¸  PARTIAL SUCCESS"
                  echo "ğŸ§ª Tests: PASSED"
                  echo "âŒ Deployment: FAILED"
                  echo "ğŸ”§ Please check deployment settings"
                else
                  echo "â„¹ï¸  Pipeline completed with mixed results"
                fi