# .github/workflows/ci-cd.yml
name: ğŸš€ CI/CD Pipeline

# When should this workflow run?
on:
  # Run on every push to main branch
  push:
    branches: [ main, master ]
  # Run on every pull request to main branch
  pull_request:
    branches: [ main, master ]
  # Allow manual triggering
  workflow_dispatch:

# Define the jobs
jobs:
  # Job 1: Test our code
  test:
    name: ğŸ§ª Run Tests
    runs-on: ubuntu-latest
    
    steps:
    # Step 1: Get our code
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    # Step 2: Set up Node.js (needed for our tests)
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    # Step 3: Run our tests
    - name: ğŸ§ª Run tests
      run: |
        echo "Running our awesome tests..."
        node test.js
        echo "âœ… All tests completed!"
        
    # Step 4: Check code quality (linting)
    - name: ğŸ” Lint code
      run: |
        echo "Checking code quality..."
        npm run lint
        echo "âœ… Code looks great!"

  # Job 2: Deploy to GitHub Pages (only after tests pass)
  deploy:
    name: ğŸŒ Deploy to Production
    runs-on: ubuntu-latest
    needs: test  # This job only runs if 'test' job succeeds
    
    # Only deploy on pushes to main/master, not on pull requests
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
    
    steps:
    # Step 1: Get our code
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    # Step 2: Deploy to GitHub Pages
    - name: ğŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        commit_message: 'ğŸš€ Deploy: ${{ github.event.head_commit.message }}'
        
    # Step 3: Celebrate! 
    - name: ğŸ‰ Deployment Success
      run: |
        echo "ğŸ‰ Your app is now live!"
        echo "ğŸŒ Visit: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo "â­ Great job on your first CI/CD pipeline!"

  # Job 3: Notify about the deployment
  notify:
    name: ğŸ“¢ Send Notifications  
    runs-on: ubuntu-latest
    needs: [test, deploy]
    if: always() # Run even if previous jobs fail
    
    steps:
    - name: ğŸ“Š Report Status
      run: |
        if [[ "${{ needs.test.result }}" == "success" && "${{ needs.deploy.result }}" == "success" ]]; then
          echo "âœ… PIPELINE SUCCESS!"
          echo "ğŸ§ª Tests: PASSED"
          echo "ğŸš€ Deployment: SUCCESS"
          echo "ğŸŒ Your app is live and ready!"
        elif [[ "${{ needs.test.result }}" == "failure" ]]; then
          echo "âŒ PIPELINE FAILED!"
          echo "ğŸ§ª Tests: FAILED"
          echo "ğŸ”§ Please check your code and fix the failing tests"
        elif [[ "${{ needs.deploy.result }}" == "failure" ]]; then
          echo "âš ï¸  PARTIAL SUCCESS"
          echo "ğŸ§ª Tests: PASSED"
          echo "âŒ Deployment: FAILED"
          echo "ğŸ”§ Please check deployment settings"
        else
          echo "â„¹ï¸  Pipeline completed with mixed results"
        fi
